<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <style>
body{
margin:0;
font-family:system-ui;
background:#f1f3f6;
}

.header{
background:#111;
color:white;
padding:12px;
text-align:center;
font-size:18px;
}

.container{
padding:15px;
margin-bottom:80px;
}

h2{
margin-top:25px;
}

form{
background:white;
padding:15px;
border-radius:10px;
margin-bottom:20px;
box-shadow:0 2px 8px rgba(0,0,0,0.08);
}

input, select{
width:100%;
padding:8px;
margin-bottom:8px;
border-radius:6px;
border:1px solid #ccc;
}

button{
padding:8px;
border:none;
border-radius:6px;
cursor:pointer;
}

.add-btn{
background:#2874f0;
color:white;
width:100%;
}

.edit-btn{
background:#ffa000;
color:white;
}

.delete-btn{
background:#d32f2f;
color:white;
}

.card{
background:white;
padding:10px;
border-radius:8px;
margin-bottom:10px;
box-shadow:0 2px 8px rgba(0,0,0,0.08);
}

.card img{
width:80px;
height:60px;
object-fit:cover;
border-radius:6px;
}

.flex{
display:flex;
justify-content:space-between;
align-items:center;
gap:10px;
}

.error{
color:red;
text-align:center;
}
</style>
  <title>Document</title>
</head>
<body>
  <div class="header">MyShop Admin Panel</div>

<div class="container">

<h2>Add Product</h2>
<form id="product-form">
<input type="hidden" id="product-id">
<input type="text" id="name" placeholder="Product Name" required>
<input type="number" id="price" placeholder="Price" required>
<input type="text" id="image" placeholder="Image URL">
<input type="number" id="quantity" placeholder="Stock Quantity" required>

<select id="category">
<option>Mobile</option>
<option>Fashion</option>
<option>Electronics</option>
<option>Grocery</option>
<option>Appliances</option>
<option>Books</option>
</select>
<button type="submit" class="add-btn">Save Product</button>
</form>
  <h2>Product List</h2>
<div id="product-list"></div>
<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm"

const supabaseUrl = "https://ooiumaohawwtqtiodqcv.supabase.co"
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9vaXVtYW9oYXd3dHF0aW9kcWN2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExNDQ1MjMsImV4cCI6MjA4NjcyMDUyM30.S_1J8CFMa1KJUYfk1VYeUcFRqUo23NEGzNlxr5fQsvA"
const supabase = createClient(supabaseUrl, supabaseKey)

/* ================= SEARCH BAR ADD (AUTO CREATE) ================= */

const searchInput = document.createElement("input")
searchInput.placeholder = "Search Product..."
searchInput.style = "width:100%;padding:8px;margin-bottom:10px;border-radius:6px;border:1px solid #ccc;"
document.querySelector("#product-list").before(searchInput)

/* ================= LOAD PRODUCTS ================= */

loadProducts()

async function loadProducts(searchTerm=""){

let query = supabase
.from("products")
.select("*")
.order("id",{ascending:false})

if(searchTerm){
query = query.or(`name.ilike.%${searchTerm}%,category.ilike.%${searchTerm}%`)
}

const { data, error } = await query

if(error){
console.log(error)
return
}

const list=document.getElementById("product-list")
list.innerHTML=""

if(!data.length){
list.innerHTML="<p>No Product Found</p>"
return
}

data.forEach(p=>{
list.innerHTML+=`
<div class="card">
<div class="flex">
<div>
<img src="${p.image || 'https://via.placeholder.com/80'}">
<p><b>${p.name}</b></p>
<p>₹${p.price}</p>
<p>${p.category}</p>
<p>Stock: ${p.quantity}</p>
</div>
<div>
<button class="edit-btn"
onclick="editProduct(${p.id},'${p.name}',${p.price},'${p.image}','${p.category}',${p.quantity})">
Edit
</button>

<button class="delete-btn"
onclick="deleteProduct(${p.id})">
Delete
</button>
</div>
</div>
</div>`
})
}

/* ================= LIVE SEARCH ================= */

searchInput.addEventListener("input",(e)=>{
loadProducts(e.target.value)
})

/* ================= PRODUCT FORM ================= */

document.getElementById("product-form")
.addEventListener("submit",async(e)=>{

e.preventDefault()

const id=document.getElementById("product-id").value
const name=document.getElementById("name").value
const price=Number(document.getElementById("price").value)
const image=document.getElementById("image").value
const category=document.getElementById("category").value
const quantity=Number(document.getElementById("quantity").value)

if(id){
await supabase.from("products")
.update({name,price,image,category,quantity})
.eq("id",id)
}else{
await supabase.from("products")
.insert([{name,price,image,category,quantity}])
}

e.target.reset()
loadProducts()
})

/* ================= EDIT ================= */

window.editProduct=(id,name,price,image,category,quantity)=>{
document.getElementById("product-id").value=id
document.getElementById("name").value=name
document.getElementById("price").value=price
document.getElementById("image").value=image
document.getElementById("category").value=category
document.getElementById("quantity").value=quantity
}

/* ================= DELETE ================= */

window.deleteProduct=async(id)=>{
if(confirm("Delete this product?")){
await supabase.from("products").delete().eq("id",id)
loadProducts()
}
}

/* ================= REMOVE BANNER ERROR ================= */
// loadBanners() removed because banner section নেই এই page-এ

</script>


</body>
</html>